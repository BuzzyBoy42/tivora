<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ArcadeKit — Home</title>
<style>
  :root{ --bg:#0f1020; --panel:rgba(22,24,42,.55); --ink:#e8e9ff; --muted:#a3a9bd; --accent:#7c93ff }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#0f1020 0%, #0b0c18 100%); color:var(--ink); font:600 15px/1.45 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif}
  a{color:inherit;text-decoration:none}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:16px 18px;border-bottom:1px solid rgba(255,255,255,.06); background:rgba(12,13,27,.6); backdrop-filter: blur(10px)}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#5b74ff,#8ac6ff)}
  .actions{display:flex;gap:8px}
  .btn{background:#11152a;border:1px solid rgba(255,255,255,.12); color:var(--ink); padding:10px 12px;border-radius:10px;cursor:pointer}
  .btn:hover{background:#141936}
  main{max-width:1100px;margin:24px auto;padding:0 16px;display:grid;gap:18px}
  section{background:var(--panel); border:1px solid rgba(124,147,255,.2); border-radius:14px; padding:16px; box-shadow:0 18px 60px rgba(0,0,0,.35)}
  h2{margin:0 0 10px;font-size:18px;color:var(--accent)}
  .row{display:grid;gap:10px}
  .join{display:flex;gap:10px; flex-wrap:wrap}
  input[type=text]{flex:1; min-width:220px; background:#0d1130; border:1px solid rgba(255,255,255,.12); color:var(--ink); border-radius:10px; padding:10px 12px; font:600 15px/1 Inter}
  .grid{display:grid; gap:12px; grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
  .card{background:#0f1430;border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px; display:grid; gap:10px}
  .card h3{margin:0;font-size:16px}
  .meta{color:var(--muted); font-size:12px}
  .card .bar{display:flex; gap:8px; flex-wrap:wrap}
  .pill{display:inline-flex; align-items:center; gap:6px; font-size:12px; color:var(--muted)}
  .sep{height:1px;background:rgba(255,255,255,.07);margin:6px -12px}
  .hint{color:var(--muted); font-size:12px}
  .danger{border-color: rgba(255,120,120,.2) !important}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo"></div>
    <div>ArcadeKit</div>
  </div>
  <div class="actions">
    <a class="btn" href="./landingpage.html">Landing</a>
    <a class="btn" href="./2d.html">Open Editor</a>
  </div>
</header>

<main>
  <!-- Join With Code -->
  <section>
    <h2>Join With Code</h2>
    <div class="row">
      <div class="join">
        <input id="joinCode" type="text" placeholder="Enter 6-character code (e.g., A1B2C3)" maxlength="8" />
        <button class="btn" id="joinBtn">Join</button>
        <span class="hint" id="joinHint">Ask the host for a code. (Demo pages; no server yet)</span>
      </div>
    </div>
  </section>

  <!-- Featured Sets (templates) -->
  <section>
    <h2>Sets</h2>
    <div class="grid" id="featured"></div>
  </section>

  <!-- My Sets (localStorage) -->
  <section>
    <h2>My Sets</h2>
    <div class="row">
      <div class="bar">
        <button class="btn" id="newSetBtn">Create New Set</button>
        <span class="hint">Saved to your browser only. Use GitHub to share.</span>
      </div>
      <div class="grid" id="mysets"></div>
    </div>
  </section>
</main>

<script>
  // ---------- Storage helpers ----------
  const LS_SETS = 'gk_sets_v1'; // [{id,name,updated,map?}]
  function getSets(){ try{ return JSON.parse(localStorage.getItem(LS_SETS))||[] }catch{ return [] } }
  function saveSets(arr){ localStorage.setItem(LS_SETS, JSON.stringify(arr)) }
  function addSet(name, map){ const arr=getSets(); const id='set_'+Date.now().toString(36); arr.unshift({id,name,updated:Date.now(),map:map||null}); saveSets(arr); return id; }
  function removeSet(id){ saveSets(getSets().filter(s=>s.id!==id)) }
  function fmtTime(t){ const d=new Date(t); return d.toLocaleString() }

  // ---------- Templates (rendered via ?template=) ----------
  const templates = [
    { key:'meadow', name:'Meadow Run', desc:'Grasslands with a river & sandbanks', tags:['Grass','Water','Sand'] },
    { key:'island', name:'Island Dash', desc:'Small island ringed by water', tags:['Water','Sand'] },
    { key:'arena',  name:'Stone Arena', desc:'Symmetric arena with obstacles', tags:['Stone','Walls'] },
  ];

  // ---------- UI wiring ----------
  const $featured = document.getElementById('featured');
  const $mysets = document.getElementById('mysets');

  function renderFeatured(){
    $featured.innerHTML='';
    for(const t of templates){
      const el=document.createElement('div'); el.className='card';
      el.innerHTML = `
        <h3>${t.name}</h3>
        <div class="meta">${t.desc}</div>
        <div class="bar">${t.tags.map(x=>`<span class="pill">#${x}</span>`).join(' ')}</div>
        <div class="sep"></div>
        <div class="bar">
          <a class="btn" href="./2d.html?template=${encodeURIComponent(t.key)}">Open</a>
          <button class="btn" data-dup="${t.key}">Duplicate to My Sets</button>
        </div>
      `;
      $featured.appendChild(el);
    }
    // duplicate -> just creates a placeholder set that loads template in editor
    $featured.querySelectorAll('[data-dup]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const key=btn.getAttribute('data-dup');
        const id = addSet(`[Template] ${key}`, { template:key });
        location.href = `./2d.html?setId=${encodeURIComponent(id)}`;
      });
    });
  }

  function renderMySets(){
    const sets = getSets();
    $mysets.innerHTML = sets.length ? '' : '<div class="hint">No sets yet — open a template or the editor, then “Save to My Sets”.</div>';
    for(const s of sets){
      const el=document.createElement('div'); el.className='card';
      el.innerHTML = `
        <h3>${s.name}</h3>
        <div class="meta">Updated: ${fmtTime(s.updated)}</div>
        <div class="sep"></div>
        <div class="bar">
          <a class="btn" href="./2d.html?setId=${encodeURIComponent(s.id)}">Open</a>
          <button class="btn danger" data-del="${s.id}">Delete</button>
        </div>
      `;
      $mysets.appendChild(el);
    }
    $mysets.querySelectorAll('[data-del]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id=btn.getAttribute('data-del');
        if(confirm('Delete this set?')){ removeSet(id); renderMySets(); }
      });
    });
  }

  // Join with Code (placeholder flow)
  document.getElementById('joinBtn').addEventListener('click', ()=>{
    const code = document.getElementById('joinCode').value.trim().toUpperCase();
    const hint = document.getElementById('joinHint');
    if(!/^[A-Z0-9]{4,8}$/.test(code)){
      hint.textContent='Enter a valid code (letters & numbers, 4–8 chars).';
      return;
    }
    // No server yet; route to 2d with a param so you can branch later.
    location.href = `./2d.html?room=${encodeURIComponent(code)}`;
  });

  // Create new set: open fresh editor
  document.getElementById('newSetBtn').addEventListener('click', ()=>{
    location.href = './2d.html';
  });

  renderFeatured();
  renderMySets();
</script>
</body>
</html>
