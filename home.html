<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tivora — Home</title>
<style>
  :root{--bg:#faf7ff; --panel:#fff; --ink:#0b0d18; --muted:#6b7280; --border:#ebe8f2; --accent:#6e4cff; --pill:#f1ecff; --shadow:0 10px 30px rgba(20,20,40,.06); --radius:16px;}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font:600 15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif}
  a{color:inherit;text-decoration:none}
  header{position:sticky;top:0;z-index:10;background:#fffccf00;border-bottom:1px solid var(--border);backdrop-filter:saturate(120%) blur(6px)}
  .nav{max-width:1140px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:14px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800}
  .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#7d5cff,#9e94ff)}
  .tab{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#fff}
  .right{margin-left:auto;display:flex;gap:8px}
  .chip{padding:8px 12px;border-radius:999px;border:1px solid var(--border);color:#444;background:#fff}

  main{max-width:1140px;margin:22px auto;padding:0 16px}
  h1{font-size:42px;letter-spacing:.2px;margin:18px 0}
  section.block{background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; margin:22px 0;}
  .block h2{margin:0 0 12px;font-size:22px}
  .pillrow{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  .pill{padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;color:#333}
  .pill.active{background:var(--pill); border-color:#e4dcff; color:#4b36c9}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  input[type=text]{flex:1; min-width:260px; padding:12px 14px; border-radius:12px; border:1px solid var(--border); background:#fff; color:var(--ink); font:600 15px/1.1 inherit;}
  .btn{padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}
  .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .hint{color:var(--muted);font-weight:500}
  .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  .card{background:#fff;border:1px solid var(--border);border-radius:14px;padding:14px;display:grid;gap:10px;box-shadow:var(--shadow)}
  .card h3{margin:0;font-size:16px}
  .meta{color:var(--muted);font-size:12px}
  .bar{display:flex;gap:8px;flex-wrap:wrap}
  .danger{border-color:#ffd1d1;background:#fff}
  .empty{border:1px dashed var(--border);border-radius:12px;padding:24px;text-align:center;color:var(--muted)}
</style>
</head>
<body>
<header>
  <nav class="nav">
    <div class="brand"><div class="logo"></div>Tivora</div>
    <a class="tab" href="./index.html">Landing</a>
    <a class="tab" href="./home.html">Home</a>
    <a class="tab" href="./host.html">Host</a>
    <a class="tab" href="./player.html">Join</a>
    <div class="right">
      <a class="chip" href="./2d.html">Editor</a>
      <a class="chip" href="#mysets">My Sets</a>
    </div>
  </nav>
</header>

<main>
  <h1>Home</h1>

  <!-- JOIN WITH CODE -->
  <section id="join" class="block">
    <h2>Join With Code</h2>
    <div class="pillrow">
      <span class="pill active">Now</span>
      <span class="pill">Scheduled</span>
    </div>
    <div class="row">
      <input id="joinCode" type="text" placeholder="Enter 6-character code (e.g., A1B2C3)" maxlength="8" />
      <button class="btn primary" id="joinBtn">Join</button>
      <a class="btn" href="./host.html">Host a Game</a>
      <span class="hint" id="joinHint">Ask the host for a code.</span>
    </div>
  </section>

  <!-- SETS (FEATURED) -->
  <section id="sets" class="block">
    <h2>Sets</h2>
    <div class="pillrow">
      <span class="pill active">All</span>
      <span class="pill">Popular</span>
      <span class="pill">New</span>
    </div>
    <div class="grid" id="featured"></div>
  </section>

  <!-- MY SETS -->
  <section id="mysets" class="block">
    <h2>My Sets</h2>
    <div class="row" style="margin-bottom:8px">
      <button class="btn primary" id="newSetBtn">Create New Set</button>
      <span class="hint">Saved locally to your browser. Use GitHub to share.</span>
    </div>
    <div id="mysetsGrid" class="grid"></div>
  </section>
</main>

<script>
  // ---------- Local sets ----------
  const LS_SETS='gk_sets_v1';
  function getSets(){ try{ return JSON.parse(localStorage.getItem(LS_SETS))||[] }catch{ return [] } }
  function saveSets(v){ localStorage.setItem(LS_SETS, JSON.stringify(v)) }
  function addSet(name,map){ const all=getSets(); const id='set_'+Date.now().toString(36); all.unshift({id,name,updated:Date.now(),map:map||null}); saveSets(all); return id; }
  function removeSet(id){ saveSets(getSets().filter(s=>s.id!==id)) }
  function fmt(t){ return new Date(t).toLocaleString() }

  const templates = [
    { key:'meadow', name:'Meadow Run', desc:'Grasslands with a river & sandbanks', tags:['Grass','Water','Sand'] },
    { key:'island', name:'Island Dash', desc:'Small island ringed by water', tags:['Water','Sand'] },
    { key:'arena',  name:'Stone Arena', desc:'Symmetric arena with obstacles', tags:['Stone','Walls'] },
  ];

  const $featured = document.getElementById('featured');
  const $my = document.getElementById('mysetsGrid');

  function renderFeatured(){
    $featured.innerHTML='';
    templates.forEach(t=>{
      const el=document.createElement('div'); el.className='card';
      el.innerHTML = `
        <h3>${t.name}</h3>
        <div class="meta">${t.desc}</div>
        <div class="bar">${t.tags.map(x=>`<span class="pill">${x}</span>`).join('')}</div>
        <div class="bar">
          <a class="btn" href="./2d.html?template=${encodeURIComponent(t.key)}">Open</a>
          <button class="btn" data-dup="${t.key}">Duplicate to My Sets</button>
        </div>`;
      $featured.appendChild(el);
    });
    $featured.querySelectorAll('[data-dup]').forEach(b=>{
      b.addEventListener('click', ()=>{
        const id = addSet(`[Template] ${b.getAttribute('data-dup')}`, { template:b.getAttribute('data-dup') });
        location.href = `./2d.html?setId=${encodeURIComponent(id)}`;
      });
    });
  }

  function renderMySets(){
    const sets = getSets();
    if(!sets.length){
      $my.innerHTML = `<div class="empty">No sets yet — open a template or the editor, then “Save to My Sets”.</div>`;
      return;
    }
    $my.innerHTML='';
    sets.forEach(s=>{
      const el=document.createElement('div'); el.className='card';
      el.innerHTML = `
        <h3>${s.name}</h3>
        <div class="meta">Updated: ${fmt(s.updated)}</div>
        <div class="bar">
          <a class="btn" href="./2d.html?setId=${encodeURIComponent(s.id)}">Open</a>
          <button class="btn danger" data-del="${s.id}">Delete</button>
        </div>`;
      $my.appendChild(el);
    });
    $my.querySelectorAll('[data-del]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id=btn.getAttribute('data-del');
        if(confirm('Delete this set?')){ removeSet(id); renderMySets(); }
      });
    });
  }

  // Join flow -> player.html
  document.getElementById('joinBtn').addEventListener('click', ()=>{
    const code = document.getElementById('joinCode').value.trim().toUpperCase();
    const hint = document.getElementById('joinHint');
    if(!/^[A-Z0-9]{4,8}$/.test(code)){ hint.textContent='Enter a valid code (letters & numbers, 4–8 chars).'; return; }
    location.href = `./player.html?code=${encodeURIComponent(code)}`;
  });

  document.getElementById('newSetBtn').addEventListener('click', ()=>location.href='./2d.html');

  renderFeatured();
  renderMySets();
</script>
</body>
</html>
